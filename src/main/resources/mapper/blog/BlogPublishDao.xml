<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xjtu.dbc.robserver.blog.publish.dao.BlogPublishDao">
    <!-- 根据 ID 获取用户 -->
    <select id="getLastId" resultType="java.lang.Integer">
        select max(userid)
        from user
    </select>

    <select id="getLastTagId" resultType="java.lang.Integer">
        select max(tagid)
        from tag
    </select>

    <insert id="addBlog">
        INSERT INTO article(articleid, articletype, articlestatus, title, content, cost, createtime, lastmodifytime, replyto, authorid, category)
        VALUES (#{articleid}, #{articletype}, #{articlestatus}, #{title}, #{content}, #{cost}, #{createtime}, #{lastmodifytime}, #{replyto}, #{authorid}, #{category});
    </insert>

    <insert id="addTag">
        INSERT INTO tag(tagid,tagname,ownerid)
        VALUES (#{tagid}, #{t_id}, #{myid})
    </insert>

    <select id="selectTagListByArtileid" resultType="java.lang.String">
        select tagname
        from article_has_tag,tag
        where articleid=#{articleid} and article_has_tag.tagid = tag.tagid
    </select>

    <select id="selectTagnameListByUserid" resultType="java.lang.String">
        select tagname
        from tag
        where ownerid=#{myid}
    </select>

    <select id="selectTagidUseTagname" resultType="java.lang.Integer">
        select tagid
        from tag
        where ownerid=#{myid} and tagname=#{tagname}
    </select>

    <select id="selectTagListByUserid" resultType="com.xjtu.dbc.robserver.common.model.tag.Tag">
        select *
        from tag
        where ownerid=#{myid}
    </select>

    <update id="updateBlogByArticleid">
        UPDATE article
        SET
            articlestatus  = #{articlestatus},
            title          = #{title},
            content        = #{content},
            lastmodifytime = #{lastmodifytime},
            category       = #{category},
        WHERE articleid = #{articleid}
    </update>

    <insert id="addTagForBlog">
        INSERT INTO article_has_tag(articleid,tagid)
        VALUES (#{articleid}, #{tagid})
    </insert>

    <delete id="dropTagForBlog">
        DELETE FROM article_has_tag
        WHERE tagid = #{tagid} and articleid=#{articleid}
    </delete>

    <select id="selectBlogDetailByArticleid" resultType="com.xjtu.dbc.robserver.common.model.article.Article">
        select *
        from article
        where articleid=#{articleid}
    </select>

</mapper>